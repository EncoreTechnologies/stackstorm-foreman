version: 1.0

description: Workflow to list all hosts that haven't reported 

input:
  - connection
  - server
  - username
  - password
  - time
  - search
  - per_page

tasks:
  task1:
    action: foreman.hosts.index
    input:
      connection: <% ctx().connection %>
      server: <% ctx().server %>
      username: <% ctx().username %>
      password: <% ctx().password %>
      search: <% concat(ctx().search, ctx().time) %>
      per_page: <% ctx().per_page %>
    next:
      - when: <% succeeded() %>
        publish:
          - stdout: <% result().stdout %>
          - stderr: <% result().stderr %>
          - listdetails: <% result().result.results %>

output: 
 - machines: <% dict(ctx(listdetails).select([$.certname, $.subscription_facet_attributes.last_checkin])) %>
